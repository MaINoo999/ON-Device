#define F_CPU 14745600UL
#include <avr/io.h>
#include <util/delay.h>

// ë‹¨ì¼ ë¬¸ì ì „ì†¡ í•¨ìˆ˜
void putch(unsigned char data) {
	// ì†¡ì‹  ê°€ëŠ¥í•  ë•Œê¹Œì§€ ëŒ€ê¸°
	while (!(UCSR0A & (1 << UDRE0)));
	UDR0 = data;
}

int main(void) {
	// ì¶œë ¥í•  ë¬¸ìì—´
	unsigned char text[] = "Hello 3\r\n";
	unsigned char i;

	// ------------------- í¬íŠ¸ ì´ˆê¸°í™” -------------------

	// TX í•€(PE1)ì„ HIGHë¡œ ì„¤ì •í•˜ì—¬ USART IDLE ìƒíƒœ ìœ ì§€
	PORTE |= (1 << PE1);   // TX ê¸°ë³¸ê°’: HIGH
	DDRE |= (1 << PE1);    // PE1ì„ ì¶œë ¥ìœ¼ë¡œ ì„¤ì •

	// ------------------- ì´ˆê¸° ì§€ì—° -------------------

	// MCU ë¶€íŒ… í›„ í„°ë¯¸ë„ ì—°ê²°ë  ì‹œê°„ì„ í™•ë³´ (ì¤‘ìš”)
	_delay_ms(1000);  // ğŸ’¡ 1ì´ˆ ì§€ì—° â†’ í•˜ì´í¼í„°ë¯¸ë„ì´ ë¨¼ì € ì¤€ë¹„ë˜ê²Œ í•¨

	// ------------------- USART0 ì´ˆê¸°í™” -------------------

	UCSR0A = 0x00;

	// ì†¡ì‹ (TX) ë° ìˆ˜ì‹ (RX) ê¸°ëŠ¥ í™œì„±í™”
	UCSR0B = (1 << RXEN0) | (1 << TXEN0);

	// ë¹„ë™ê¸° ëª¨ë“œ, 8ë¹„íŠ¸ ë°ì´í„°, No parity, 1 Stop bit
	UCSR0C = (1 << UCSZ01) | (1 << UCSZ00);

	// ë³´ìœ¨ ì„¤ì •: 115200bps @ 14.7456MHz â†’ UBRR = 7
	UBRR0H = 0;
	UBRR0L = 7;

	// ------------------- ë¬¸ìì—´ ë°˜ë³µ ì „ì†¡ -------------------

	while (1) {
		i = 0;

		// ë¬¸ìì—´ ëê¹Œì§€ ë¬¸ì ì „ì†¡
		while (text[i] != '\0') {
			putch(text[i++]);
		}

		_delay_ms(1000);  // 1ì´ˆ ê°„ê²©ìœ¼ë¡œ ë°˜ë³µ ì¶œë ¥
	}
}
